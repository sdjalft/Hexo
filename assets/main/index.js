System.register("chunks:///main.js",["cc"],(function(){"use strict";var t,e,n,r,i,o,a,s,l,u,c,h,p;return{setters:[function(f){t=f.cclegacy,e=f._decorator,n=f.Component,r=f.EventTarget,i=f.Node,o=f.RichText,a=f.Prefab,s=f.Vec3,l=f.director,u=f.instantiate,c=f.math,h=f.EventHandler,p=f.Button}],execute:function(){function f(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,g(t,e)}function g(t,e){return(g=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}function d(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function m(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function v(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(n)return(n=n.call(t)).next.bind(n);if(Array.isArray(t)||(n=function(t,e){if(t){if("string"==typeof t)return m(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?m(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0;return function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function y(t,e,n,r){n&&Object.defineProperty(t,e,{enumerable:n.enumerable,configurable:n.configurable,writable:n.writable,value:n.initializer?n.initializer.call(r):void 0})}function C(t,e,n,r,i){var o={};return Object.keys(r).forEach((function(t){o[t]=r[t]})),o.enumerable=!!o.enumerable,o.configurable=!!o.configurable,("value"in o||o.initializer)&&(o.writable=!0),o=n.slice().reverse().reduce((function(n,r){return r(t,e,n)||n}),o),i&&void 0!==o.initializer&&(o.value=o.initializer?o.initializer.call(i):void 0,o.initializer=void 0),void 0===o.initializer&&(Object.defineProperty(t,e,o),o=null),o}var b;t._RF.push({},"81edbszm2BF9bUYKZppLGQ8","NewComponent",void 0);var w=e.ccclass;e.property,w("NewComponent")(b=function(t){function e(){for(var e,n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(e=t.call.apply(t,[this].concat(r))||this).times=1,e}f(e,t);var n=e.prototype;return n.start=function(){},n.update=function(t){},e}(n));t._RF.pop(),t._RF.push({},"cdd0bEta7pECKoqrttrrmmT","const",void 0),t._RF.pop(),t._RF.push({},"a4674F0on1D9JK/43nblCH/","random-event",void 0);var S=[{name:"和袋鼠自由搏击没打过, 入院3天"},{name:"成为鲸教徒后被抓, 入狱3天"},{name:"投资旗下“XXWorks”产品大卖, 获得现金20000元"},{name:"被勒令要求请别人恰饭, 痛失3000元"},{name:"研发“XX开发”模块出现重大事故, 赔偿用户20000元"}];t._RF.pop(),t._RF.push({},"d592c9ZsGdKBoHsiCx2pRci","event-emitter",void 0);var R,T,P,_,M,E,x,F=new(function(){function t(){this.eventEmitter=new r}var e=t.prototype;return e.on=function(t,e,n){this.eventEmitter.on(t,e,n)},e.off=function(t,e,n){this.eventEmitter.off(t,e,n)},e.emit=function(t,e,n){this.eventEmitter.emit(t,e,n)},t}());t._RF.pop(),t._RF.push({},"567b0XgheFDBJWKaewfSfsO","MapTile",void 0);var L,z,k,O,A,V=e.ccclass,j=e.property,N=(R=V("MapTile"),T=j({type:[i]}),P=j({type:[i]}),R((E=C((M=function(t){function e(){for(var e,n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return y(e=t.call.apply(t,[this].concat(r))||this,"previousTile",E,d(e)),y(e,"nextTile",x,d(e)),e}f(e,t);var n=e.prototype;return n.action=function(){this.scheduleOnce((function(){F.emit("calculateComplete",null)}),.5)},n.start=function(){},n.update=function(t){},e}(n)).prototype,"previousTile",[T],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),x=C(M.prototype,"nextTile",[P],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),_=M))||_);t._RF.pop(),t._RF.push({},"69977Q+V/lNhqSInRoR/jUV","RandomEventTile",void 0);var B=e.ccclass,G=e.property;L=B("RandomEventTile"),z=G({type:i}),L((A=C((O=function(t){function e(){for(var e,n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return y(e=t.call.apply(t,[this].concat(r))||this,"eventModal",A,d(e)),e}f(e,t);var n=e.prototype;return n.generateEvent=function(){var t=Math.floor(Math.random()*S.length);return S[t]},n.showModal=function(){var e=this,n=this.generateEvent();this.eventModal.children[0].getComponent(o).string=n.name,this.eventModal.active=!0,this.scheduleOnce((function(){e.eventModal.active=!1,t.prototype.action.call(e)}),3)},n.action=function(){this.showModal()},n.start=function(){},n.update=function(t){},e}(N)).prototype,"eventModal",[z],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),k=O));t._RF.pop(),t._RF.push({},"4e1a3mbVHVG+5rPLAtrQ2oY","status-machine",void 0);var H,K,U,X,I,W,q,D,J,Q=function(){function t(t){this.name=void 0,this.name=t.name,this.needStateChange=t.needStateChange,t.onEnter&&(this.onEnter=t.onEnter),t.onExit&&(this.onExit=t.onExit),t.onPause&&(this.onPause=t.onPause),t.onResume&&(this.onResume=t.onResume)}var e=t.prototype;return e.onEnter=function(){console.log("[STATE] 进入状态: "+this.name)},e.onExit=function(){},e.onPause=function(){},e.onResume=function(){},e.needStateChange=function(){return console.log(this.name+" state执行方法未重写!"),{needChange:!0,newState:"",isLastStatus:!0}},t}(),Z=function(){function t(t){this.status=void 0,this.statusRegisterMap=void 0;var e=new Q({name:"NULL",needStateChange:function(){return console.log("当前状态为空状态!"),{needChange:!1}},onEnter:function(){},onExit:function(){},onResume:function(){},onPause:function(){}});this.status=[],this.status.push(e),this.statusRegisterMap=t.statusRegisterMap,t.initState&&this.status.push(t.initState)}var e=t.prototype;return e.registerState=function(t){this.statusRegisterMap.set(t.name,t)},e.getCurrentState=function(){return this.status[this.status.length-1]},e.getLastState=function(){var t=this.status[this.status.length-2];return t&&"NULL"!==t.name||console.error("Error: 上个状态不存在!"),t},e.clearStack=function(t){for(;1===this.status.length;){this.status.pop().onExit(),this.status[this.status.length-1].onResume()}this.status[this.status.length-1].onPause();var e=this.statusRegisterMap[t];this.status.push(e),e.onEnter()},e.changeState=function(){var t=this.getCurrentState().needStateChange();if(t.needChange){var e=this.statusRegisterMap[t.newState];if(!e)throw new Error("Error: 状态 "+t.newState+" 未注册就尝试进入！");if(t.clearStack)this.clearStack(t.newState);else if(t.isLastStatus){this.status.pop().onExit(),this.status[this.status.length-1].onResume()}else this.status[this.status.length-1].onPause(),this.status.push(e),e.onEnter()}},t}();t._RF.pop(),t._RF.push({},"e9a4dDV98dNxJdTXeV+oz/E","game",void 0);var Y=e.ccclass,$=e.property,tt=(H=Y("game"),K=$({type:[i]}),U=$({type:a}),X=$({type:i}),H((q=C((W=function(t){function e(){for(var e,n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(e=t.call.apply(t,[this].concat(r))||this).statusMachine=void 0,e.statusChangeTrigger=void 0,e.playerList=void 0,e.currentPlayerOrder=void 0,y(e,"spawnTiles",q,d(e)),y(e,"playerPrefab",D,d(e)),y(e,"mainCamera",J,d(e)),e}f(e,t);var n=e.prototype;return n.registerState=function(){var t=this,e=new Q({name:"game_start",needStateChange:function(){return{needChange:!0,newState:"roll_start"}}}),n=new Q({name:"game_end",needStateChange:function(){return{needChange:!1}}}),r=new Q({name:"roll_start",needStateChange:function(){return"rollResult"===t.statusChangeTrigger?(t.statusChangeTrigger="",{needChange:!0,newState:"roll_animate"}):{needChange:!1}}}),i=new Q({name:"roll_animate",needStateChange:function(){return"rollComplete"===t.statusChangeTrigger?(t.statusChangeTrigger="",{needChange:!0,newState:"calculate_animate"}):{needChange:!1}}}),o=new Q({name:"calculate_animate",needStateChange:function(){return"calculateComplete"===t.statusChangeTrigger?{needChange:!0,newState:"roll_start",clearStack:!0}:{needChange:!1}}}),a=new Z({initState:e,statusRegisterMap:{game_start:e,game_end:n,roll_start:r,roll_animate:i,calculate_animate:o}});this.statusMachine=a},n.registerListener=function(){var t=this;F.on("rollResult",(function(){t.statusChangeTrigger="rollResult"})),F.on("rollComplete",(function(){t.statusChangeTrigger="rollComplete"})),F.on("calculateComplete",(function(){t.currentPlayerOrder=(t.currentPlayerOrder+1)%t.playerList.length,t.mainCamera.setParent(t.playerList[t.currentPlayerOrder].node),t.statusChangeTrigger="calculateComplete"}))},n.registerPlayers=function(t){var e=this;this.playerList=t.map((function(t){return t.getComponent(ht)}));var n=function(t){for(var n,r=v(e.playerList);!(n=r()).done;){if(n.value.currentTile===t)return!0}return!1};if(this.spawnTiles.length<this.playerList.length)throw Error("玩家数量小于地图出生点数!");for(var r,i=v(t);!(r=i()).done;){for(var o=r.value,a=this.spawnTiles[Math.floor(Math.random()*this.spawnTiles.length)];n(a);)a=this.spawnTiles[Math.floor(Math.random()*this.spawnTiles.length)];o.getComponent(ht).currentTile=a,o.setPosition(new s(a.position.x,a.position.y+1,a.position.z))}},n.start=function(){for(var t=l.getScene(),e=[],n=0;n<2;n++){var r=u(this.playerPrefab);r.getComponent(ht).id=n,r.getComponent(ht).rolename="littleHeart",t.addChild(r),e.push(r)}this.registerPlayers(e),this.registerState(),this.registerListener(),this.statusChangeTrigger="",this.currentPlayerOrder=0,this.mainCamera.setParent(this.playerList[0].node)},n.update=function(t){this.statusMachine.changeState()},e}(n)).prototype,"spawnTiles",[K],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),D=C(W.prototype,"playerPrefab",[U],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),J=C(W.prototype,"mainCamera",[X],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),I=W))||I);t._RF.pop(),t._RF.push({},"36a52rbKuVNfI9esVsqzzSr","get-global-state",void 0);var et,nt,rt,it,ot,at,st;t._RF.pop(),t._RF.push({},"15b5fdGqhJKdIdoizcGile6","Player",void 0);var lt,ut=e.ccclass,ct=e.property,ht=(et=ut("Player"),nt=ct(i),rt=ct(a),et((at=C((ot=function(t){function e(){for(var e,n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(e=t.call.apply(t,[this].concat(r))||this).id=void 0,e.rolename=void 0,y(e,"currentTile",at,d(e)),e.speed=3,e.currentPaths=[],e.walking=!1,y(e,"littleHeartModel",st,d(e)),e}f(e,t);var n=e.prototype;return n.onLoad=function(){this.initRole()},n.start=function(){this.registerListener()},n.update=function(t){this.walk()},n.initRole=function(){switch(this.rolename){case"littleHeart":var t=u(this.littleHeartModel);t.setParent(this.node),t.setPosition(new s(0,-.5,0))}},n.registerListener=function(){var t=this;F.on("rollComplete",(function(e){var n=l.getScene().getChildByName("gameController").getComponent(tt).currentPlayerOrder;if(t.id===n){var r=t.getWalkPath(e);t.currentPaths=r}}))},n.randomGet=function(t){return 1===t.length?t[0]:t[Math.floor(Math.random()*t.length)]},n.getWalkPath=function(t){for(var e,n,r=[],i=this.currentTile,o=i.getComponent(N),a=0;a<t;a++)n=(e=this.randomGet(o.nextTile)).getComponent(N),r.push({prevPos:new c.Vec2(o.node.position.x,o.node.position.z),nextPos:new c.Vec2(n.node.position.x,n.node.position.z),prevTile:i,targetTile:e}),i=e,o=n;return r},n.walk=function(){var t=this;if(!this.walking&&this.currentPaths.length>0){this.walking=!0;var e=this.currentPaths.shift(),n=e.nextPos.x-e.prevPos.x,r=e.nextPos.y-e.prevPos.y,i=0;this.schedule((function(){t.node.setPosition(t.node.position.x+n/25,t.node.position.y,t.node.position.z+r/25),25===(i+=1)&&(t.walking=!1,t.currentTile=e.targetTile,t.node.setPosition(t.currentTile.position.x,t.node.position.y,t.currentTile.position.z),0===t.currentPaths.length&&t.currentTile.getComponent(N).action())}),1/this.speed/25,25)}},e}(n)).prototype,"currentTile",[nt],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),st=C(ot.prototype,"littleHeartModel",[rt],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),it=ot))||it);t._RF.pop(),t._RF.push({},"90e2dNeALVLAZD8gMjWASUG","UiRollButton",void 0);var pt,ft=e.ccclass;e.property,ft("UiRollButton")(lt=function(t){function e(){for(var e,n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(e=t.call.apply(t,[this].concat(r))||this).richText=void 0,e}f(e,t);var n=e.prototype;return n.onLoad=function(){this.richText=this.node.children[0].getComponent(o);var t=new h;t.target=this.node,t.component="UiRollButton",t.handler="buttonClickCallback",this.node.getComponent(p).clickEvents.push(t)},n.buttonClickCallback=function(t){var e=Math.floor(6*Math.random()+1);F.emit("rollResult",e)},n.registerListener=function(){var t=this;F.on("rollResult",(function(e){var n=0,r="0";t.schedule((function i(){for(var o=Math.floor(6*Math.random()+1).toString();o===r;)o=Math.floor(6*Math.random()+1).toString();r=o,t.richText.string=o,(n+=1)>=14&&(t.richText.string="<color=#00ff00>"+e.toString()+"</color>",t.scheduleOnce((function(){F.emit("rollComplete",e)}),.5),t.unschedule(i))}),.1)})),F.on("rollComplete",(function(){t.node.active=!1})),F.on("calculateComplete",(function(){t.node.active=!0}))},n.start=function(){this.registerListener()},n.update=function(t){},e}(n));t._RF.pop(),t._RF.push({},"03b5fB79uVG07me3+VXmlKK","tmpStateTest",void 0);var gt=e.ccclass;e.property,gt("tmpStateTest")(pt=function(t){function e(){for(var e,n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(e=t.call.apply(t,[this].concat(r))||this).totalSteps=void 0,e}f(e,t);var n=e.prototype;return n.onLoad=function(){var t=this;this.totalSteps=0,F.on("rollComplete",(function(e){var n=t.node.getComponent(o),r=0;t.schedule((function i(){t.totalSteps+=1,n.string="总步数: "+t.totalSteps,(r+=1)>=e&&t.unschedule(i)}),.5)}))},n.start=function(){this.node.getComponent(o).string="总步数: 0"},n.update=function(t){},e}(n));t._RF.pop()}}}));

(function(r) {
  r('virtual:///prerequisite-imports/main', 'chunks:///main.js'); 
})(function(mid, cid) {
    System.register(mid, [cid], function (_export, _context) {
    return {
        setters: [function(_m) {
            var _exportObj = {};

            for (var _key in _m) {
              if (_key !== "default" && _key !== "__esModule") _exportObj[_key] = _m[_key];
            }
      
            _export(_exportObj);
        }],
        execute: function () { }
    };
    });
});